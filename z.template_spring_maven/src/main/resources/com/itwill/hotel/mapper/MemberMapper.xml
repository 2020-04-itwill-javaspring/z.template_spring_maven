<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itwill.hotel.mapper.MemberMapper">
	<select id="selectAll" resultType="Member">
		select mNo, mId, mFirstName, mLastName, mPassword, mTel, 
				mEmail, mBirth, mImg, mCountry, mCity, mAddress, 
				mZipCode, mTempPassword, mRemoveDate, mIfActive 
		from member
	</select>
	
	<select id="selectOne" parameterType="string" resultType="Member">
		select mNo, mId, mFirstName, mLastName, mPassword, mTel, 
				mEmail, mBirth, mImg, mCountry, mCity, mAddress, 
				mZipCode, mTempPassword, mRemoveDate, mIfActive
		from member
		where mId=#{mId}
	</select>
	
	<select id="checkIdExist" parameterType="string" resultType="_int">
		select count(mNo)
		from member
		where mId=#{mId}
	</select>
	
	<insert id="insertMember" parameterType="Member">
		insert into Member (mNo, mId, mFirstName, mLastName, mPassword, mTel, mEmail, mBirth, mImg, 
		 					mCountry, mCity, mAddress, mZipCode, mIfActive)
		values (member_SEQ.nextval, #{mId}, #{mFirstName}, #{mLastName}, #{mPassword}, #{mTel}, #{mEmail}, 
				#{mBirth}, null, null, null, null, null, 1)
	</insert>
	
	<delete id="deleteInactiveMember" parameterType="string">
		delete from member 
		where mId=#{mId} 
		and mIfActive=0 
		and (select m.mRemoveDate - SYSDATE
			 from member m 
			 where m.mId=#{mId} ) &lt; -30
	</delete>
	
	<update id="setTempPasswordNull" parameterType="string">
		update member
		set mTempPassword=#{mTempPassword}
		where mId=#{mId}
	</update>
	
	<update id="updatePassword" parameterType="java.util.HashMap">
		update member
		set mPassword=#{mPassword}, mTempPassword=null
		where mId=#{mId}
	</update>
	
	<select id="getTempPassword" resultType="string">
		select DBMS_RANDOM.STRING('P', 20) rand 
		FROM DUAL
	</select>
	
	<select id="checkExist" parameterType="string" resultType="_int">
		select count(mNo)
		from member
		where mId=#{mId} and mFirstName=#{mFirstName} and mLastName=#{mLastName} 
			  and mTel=#{mTel} and mEmail=#{mEmail} and mBirth=#{mBirth}
	</select>
	
	<update id="updateTempPassword" parameterType="java.util.HashMap">
		update member
		set mTempPassword=#{mTempPassword}
		where mId=#{mId}
	</update>
	
	<select id="checkExist2" parameterType="string" resultType="_int">
		select count(mNo)
		from member
		where mId=#{mId} and mPassword=#{mPassword} and mFirstName=#{mFirstName} and 
			  mLastName=#{mLastName} and mTel=#{mTel} and mEmail=#{mEmail} and mBirth=#{mBirth}
	</select>
	
	<update id="reActivateAccount" parameterType="string">
		update member
		set mIfActive=1
		where mId=#{mId}
	</update>
</mapper>